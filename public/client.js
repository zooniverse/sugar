var SugarClient,bind=function(t,i){return function(){return t.apply(i,arguments)}};SugarClient=function(){function t(t,i){this.userId=t,this.authToken=i,this.createEvent=bind(this.createEvent,this),this.__subscribeTo=bind(this.__subscribeTo,this),this.__subscribeToChannels=bind(this.__subscribeToChannels,this),this.emit=bind(this.emit,this),this.off=bind(this.off,this),this.on=bind(this.on,this),this.unsubscribeFrom=bind(this.unsubscribeFrom,this),this.subscribeTo=bind(this.subscribeTo,this),this.receiveData=bind(this.receiveData,this),this.disconnect=bind(this.disconnect,this),this.connect=bind(this.connect,this),this.primusUrl=bind(this.primusUrl,this),this.events={},this.subscriptions={},this.initializePrimus()}return t.prototype.initializePrimus=function(){var i;return i="undefined"!=typeof Primus?Primus:t.prototype.Primus,this.primus=i.connect(void 0,{websockets:!0,network:!0,manual:!0}),this.primus.on("outgoing::url",this.primusUrl),this.primus.on("data",this.receiveData)},t.prototype.primusUrl=function(t){return this.userId&&this.authToken?t.query="user_id="+this.userId+"&auth_token="+this.authToken:void 0},t.prototype.connect=function(){return this.disconnect(),this.primus.open()},t.prototype.disconnect=function(){var t,i,s,e,n;for(n=function(){var i,e;i=this.subscriptions,e=[];for(s in i)t=i[s],s.match(/^(session|user):/i)&&e.push(s);return e}.call(this),i=0,e=n.length;e>i;i++)s=n[i],delete this.subscriptions[s];return this.userKey=this.loggedIn=null,this.primus.end()},t.prototype.receiveData=function(t){return"connection"===t.type?("undefined"!=typeof console&&null!==console&&"function"==typeof console.info&&console.info("[CONNECTED] ",t),this.loggedIn=t.loggedIn,this.userKey=t.userKey,this.subscriptions[this.userKey]=!0,setTimeout(this.__subscribeToChannels,100)):this.emit(t)},t.prototype.subscribeTo=function(t){return this.subscriptions[t]?!1:(this.subscriptions[t]=!0,this.__subscribeTo(t))},t.prototype.unsubscribeFrom=function(t){return this.subscriptions[t]?(delete this.subscriptions[t],this.primus.write({action:"Unsubscribe",params:{channel:t}})):void 0},t.prototype.on=function(t,i){var s;return(s=this.events)[t]||(s[t]=[]),this.events[t].push(i)},t.prototype.off=function(t,i){return i&&this.events[t]?this.events[t]=this.events[t].filter(function(t){return t!==i}):delete this.events[t]},t.prototype.emit=function(t){var i,s,e,n,r;for(s=this.events[t.type]||[],r=[],e=0,n=s.length;n>e;e++)i=s[e],r.push(i(t));return r},t.prototype.__subscribeToChannels=function(){var t,i,s,e;s=this.subscriptions,e=[];for(i in s)t=s[i],e.push(this.__subscribeTo(i));return e},t.prototype.__subscribeTo=function(t){return this.primus.write({action:"Subscribe",params:{channel:t}})},t.prototype.createEvent=function(t,i,s){return this.primus.write({action:"Event",params:{type:t,channel:i,data:s}})},t}(),"undefined"!=typeof module&&null!==module&&(module.exports=SugarClient);
//# sourceMappingURL=./client.js.map